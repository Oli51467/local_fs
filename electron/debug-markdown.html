<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown 渲染调试</title>
    <link rel="stylesheet" href="./node_modules/github-markdown-css/github-markdown.css">
    <link rel="stylesheet" href="./node_modules/highlight.js/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f6f8fa;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .debug-info {
            background: #f1f3f4;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-family: monospace;
        }
        .status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Markdown 渲染调试页面</h1>
        
        <div class="debug-info">
            <h3>库加载状态:</h3>
            <p>marked: <span id="marked-status" class="status">检查中...</span></p>
            <p>hljs: <span id="hljs-status" class="status">检查中...</span></p>
            <p>GitHub CSS: <span id="css-status" class="status">检查中...</span></p>
        </div>
        
        <div class="debug-info">
            <h3>测试 Markdown 内容:</h3>
            <textarea id="markdown-input" rows="10" style="width: 100%; font-family: monospace;"># 标题测试

## 二级标题

这是一段**粗体**和*斜体*文本。

---

### 表格测试

| 列1 | 列2 | 列3 |
|-----|-----|-----|
| 数据1 | 数据2 | 数据3 |
| 测试A | 测试B | 测试C |

### 代码测试

```javascript
function hello() {
    console.log('Hello World!');
    return 'success';
}
```

### 列表测试

- 无序列表项1
- 无序列表项2
  - 嵌套项

1. 有序列表项1
2. 有序列表项2

> 这是一个引用块
> 可以包含多行内容</textarea>
            <button onclick="renderMarkdown()" style="margin-top: 10px; padding: 8px 16px;">渲染 Markdown</button>
        </div>
        
        <div id="markdown-output" class="markdown-body"></div>
    </div>
    
    <script src="./node_modules/marked/lib/marked.umd.js"></script>
    <script src="./node_modules/highlight.js/lib/index.js"></script>
    <script>
        // 检查库加载状态
        function checkLibraries() {
            const markedStatus = document.getElementById('marked-status');
            const hljsStatus = document.getElementById('hljs-status');
            const cssStatus = document.getElementById('css-status');
            
            // 检查 marked
            if (typeof marked !== 'undefined') {
                markedStatus.textContent = '✓ 已加载';
                markedStatus.className = 'status success';
            } else {
                markedStatus.textContent = '✗ 未加载';
                markedStatus.className = 'status error';
            }
            
            // 检查 hljs
            if (typeof hljs !== 'undefined') {
                hljsStatus.textContent = '✓ 已加载';
                hljsStatus.className = 'status success';
            } else {
                hljsStatus.textContent = '✗ 未加载';
                hljsStatus.className = 'status error';
            }
            
            // 检查 CSS
            const cssLinks = document.querySelectorAll('link[rel="stylesheet"]');
            let githubCssFound = false;
            cssLinks.forEach(link => {
                if (link.href.includes('github-markdown')) {
                    githubCssFound = true;
                }
            });
            
            if (githubCssFound) {
                cssStatus.textContent = '✓ 已加载';
                cssStatus.className = 'status success';
            } else {
                cssStatus.textContent = '✗ 未加载';
                cssStatus.className = 'status error';
            }
        }
        
        // 渲染 Markdown
        function renderMarkdown() {
            const input = document.getElementById('markdown-input').value;
            const output = document.getElementById('markdown-output');
            
            if (typeof marked === 'undefined') {
                output.innerHTML = '<p style="color: red;">错误: marked 库未加载</p>';
                return;
            }
            
            try {
                // 配置 marked
                marked.setOptions({
                    gfm: true,
                    breaks: true,
                    headerIds: true,
                    mangle: false,
                    highlight: function (code, lang) {
                        if (typeof hljs !== 'undefined') {
                            try {
                                if (lang && hljs.getLanguage(lang)) {
                                    return hljs.highlight(code, { language: lang }).value;
                                }
                                return hljs.highlightAuto(code).value;
                            } catch (e) {
                                console.warn('Highlight.js error:', e);
                                return code;
                            }
                        }
                        return code;
                    }
                });
                
                const html = marked.parse(input);
                output.innerHTML = html;
                
                console.log('渲染成功:', {
                    inputLength: input.length,
                    outputLength: html.length,
                    markedAvailable: typeof marked !== 'undefined',
                    hljsAvailable: typeof hljs !== 'undefined'
                });
                
            } catch (error) {
                console.error('渲染错误:', error);
                output.innerHTML = `<p style="color: red;">渲染错误: ${error.message}</p>`;
            }
        }
        
        // 页面加载完成后检查库状态
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkLibraries, 100);
            setTimeout(renderMarkdown, 200); // 自动渲染一次
        });
    </script>
</body>
</html>