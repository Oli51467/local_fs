<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>LoFS</title>
  <link rel="stylesheet" href="./node_modules/github-markdown-css/github-markdown.css">
  <!-- highlight.js 库 -->
  <script src="./node_modules/highlight.js/lib/common.js"></script>
  <style>
    :root {
      --bg-color: #fafafa;
      --text-color: #333333;
      --text-muted: #6c6c6c;
      --sidebar-bg: #d1d5db;
      --sidebar-text: #4a5568;
      --tree-bg: #f8f8f8;
      --tree-border: #e1e4e8;
      --tree-hover: #f0f0f0;
      --accent-color: #0366d6;
      --accent-hover: #0256cc;
      --border-light: #d1d9e0;
      --shadow-light: rgba(27, 31, 35, 0.04);
    }
    
    .dark-mode {
      --bg-color: #1e1e1e;
      --text-color: #cccccc;
      --text-muted: #969696;
      --sidebar-bg: #181818;
      --sidebar-text: #cccccc;
      --tree-bg: #252526;
      --tree-border: #3c3c3c;
      --tree-hover: #2a2d2e;
      --accent-color: #0e639c;
      --accent-hover: #1177bb;
      --border-light: #3c3c3c;
      --shadow-light: rgba(0, 0, 0, 0.3);
    }
    
    @font-face {
      font-family: 'SimSun';
      src: local('SimSun');
    }
    
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: 'Times New Roman', SimSun, serif;
      font-size: 14px;
      background-color: var(--bg-color);
      color: var(--text-color);
    }

    /* 全局移除outline */
    * {
      outline: none !important;
    }

    #app {
      display: flex;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    /* 最左侧 sidebar */
    #sidebar {
      width: 50px;
      background: var(--sidebar-bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 10px;
      color: var(--sidebar-text);
    }

    #sidebar button {
      background: none;
      border: none;
      color: var(--sidebar-text);
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 5px 0;
      cursor: pointer;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    
    #sidebar button:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    #sidebar button svg {
      width: 20px;
      height: 20px;
    }

    /* 资源管理器相关样式已移至 src/styles/explorer.css */

    /* 文件内容展示 */
    #file-content {
      flex: 1;
      padding: 10px;
      overflow: auto;
    }
    
    /* 设置页面样式已移至 src/styles/settings.css */

  </style>
</head>
<body>
  <!-- 启动页面 -->
  <div id="splash-screen">
    <div class="splash-container">
      <div class="splash-logo">
        <div class="logo-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 7V17C3 18.1046 3.89543 19 5 19H19C20.1046 19 21 18.1046 21 17V7C21 5.89543 20.1046 5 19 5H5C3.89543 5 3 5.89543 3 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8 21L16 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 17L12 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <h1 class="splash-title">LoFS</h1>
        <p class="splash-subtitle">Load Once Fast Search</p>
      </div>
      
      <div class="splash-loading">
        <div class="loading-spinner"></div>
        <p class="loading-text">正在初始化系统...</p>
      </div>
      
      <div class="splash-footer">
        <p class="version-info">Designed and powered by Oli51467</p>
      </div>
    </div>
  </div>

  <div id="app" style="display: none;">
    <!-- 左侧 sidebar -->
    <div id="sidebar">
      <button id="toggle-tree"><div id="file-icon"></div></button>
      <button id="search-btn"><div id="search-icon"></div></button>
      <button id="chat-btn"><div id="chat-icon"></div></button>
      <button id="settings-btn"><div id="settings-icon"></div></button>
      <button id="database-btn"><div id="database-icon"></div></button>
    </div>

    <!-- 文件树栏 -->
    <div id="file-tree-container">
      <div id="file-tree-resizer"></div>
      <div id="file-tree-header">
        <span id="resource-title">资源管理器</span>
        <div>
          <button id="new-folder"><div id="folder-icon"></div></button>
              <button id="new-file"><div id="new-file-icon"></div></button>
              <button id="import-files"><div id="import-icon"></div></button>
              <button id="refresh-tree"><div id="refresh-icon"></div></button>
          <button id="delete-item"><div id="trash-icon"></div></button>
        </div>
      </div>
      <div id="file-tree">Loading...</div>
      
      <!-- 搜索区域 -->
      <div id="search-area" style="display: none;">
      <div id="search-input-container">
        <input type="text" id="search-input" placeholder="搜索文件内容" />
        <div id="search-mode-toggle">
          <button class="search-mode-btn active" data-mode="text">文本检索</button>
          <button class="search-mode-btn" data-mode="image">图片检索</button>
        </div>
      </div>
        <div id="search-history"></div>
      </div>
    </div>

    <!-- 对话历史栏 -->
    <div id="chat-history-container" style="display: none;">
      <div id="chat-history-header">
        <span id="chat-history-title">对话历史</span>
        <button id="start-new-chat-btn" class="chat-history-action">新建</button>
      </div>
      <div id="chat-history-list"></div>
    </div>

    <!-- 文件内容展示 -->
    <div id="file-content"></div>

    <!-- 对话页面 -->
    <div id="chat-page" style="display: none;">
      <div id="chat-page-header">
        <div class="chat-page-header-info">
          <h2 id="chat-conversation-title">新对话</h2>
          <span id="chat-conversation-updated" class="chat-timestamp"></span>
        </div>
        <div class="chat-page-header-actions">
          <button id="chat-history-toggle" class="chat-history-toggle" title="显示/隐藏对话历史">历史</button>
        </div>
      </div>
      <div id="chat-messages-container">
        <div id="chat-messages"></div>
      </div>
      <div id="chat-input-area">
        <div id="chat-status-text"></div>
        <div class="chat-input-wrapper">
          <textarea id="chat-input" placeholder="输入你的问题，按 Enter 发送，Shift+Enter 换行"></textarea>
          <button id="chat-send-btn">发送</button>
        </div>
      </div>
    </div>
    
    <!-- 设置页面 -->
    <div id="settings-page">
      <div class="settings-section">
        <h2>外观</h2>
        <div class="setting-item">
          <span>深色模式</span>
          <label class="toggle-switch">
            <input type="checkbox" id="dark-mode-toggle">
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <section class="settings-section settings-card" id="retrieval-settings-card">
        <div class="settings-card-header">
          <div class="settings-card-titles">
            <h2>检索设置</h2>
            <p class="settings-card-subtitle">调节分块策略与混合检索权重，使检索结果更符合需求。</p>
          </div>
          <div class="settings-card-actions">
            <span id="retrieval-settings-status" class="settings-status-text" aria-live="polite"></span>
            <button type="button" id="retrieval-settings-reload" class="settings-btn ghost">恢复</button>
            <button type="button" id="retrieval-settings-save" class="settings-btn primary" disabled>保存</button>
          </div>
        </div>

        <div class="settings-card-body">
          <div class="settings-slider" data-config-key="RECURSIVE_CHUNK_SIZE">
            <div class="slider-header">
              <div class="slider-title">
                <span class="slider-label">递归分块大小</span>
                <span class="slider-hint">RECURSIVE_CHUNK_SIZE · 上限 2000</span>
              </div>
              <span class="slider-value" id="retrieval-chunk-size-value">-</span>
            </div>
            <input type="range"
                   id="retrieval-chunk-size"
                   min="50"
                   max="2000"
                   step="10"
                   value="300"
                   data-config-key="RECURSIVE_CHUNK_SIZE">
          </div>

          <div class="settings-slider" data-config-key="RECURSIVE_CHUNK_OVERLAP">
            <div class="slider-header">
              <div class="slider-title">
                <span class="slider-label">分块重叠</span>
                <span class="slider-hint">RECURSIVE_CHUNK_OVERLAP · 上限 500</span>
              </div>
              <span class="slider-value" id="retrieval-chunk-overlap-value">-</span>
            </div>
            <input type="range"
                   id="retrieval-chunk-overlap"
                   min="0"
                   max="500"
                   step="5"
                   value="80"
                   data-config-key="RECURSIVE_CHUNK_OVERLAP">
          </div>

          <div class="settings-slider" data-config-key="BM25S_WEIGHT">
            <div class="slider-header">
              <div class="slider-title">
                <span class="slider-label">BM25S 权重</span>
                <span class="slider-hint">BM25S_WEIGHT · 上限 1.0</span>
              </div>
              <span class="slider-value" id="retrieval-bm25s-weight-value">-</span>
            </div>
            <input type="range"
                   id="retrieval-bm25s-weight"
                   min="0"
                   max="1"
                   step="0.01"
                   value="0.70"
                   data-config-key="BM25S_WEIGHT">
          </div>

          <div class="settings-slider" data-config-key="EMBEDDING_WEIGHT">
            <div class="slider-header">
              <div class="slider-title">
                <span class="slider-label">向量检索权重</span>
                <span class="slider-hint">EMBEDDING_WEIGHT · 上限 1.0</span>
              </div>
              <span class="slider-value" id="retrieval-embedding-weight-value">-</span>
            </div>
            <input type="range"
                   id="retrieval-embedding-weight"
                   min="0"
                   max="1"
                   step="0.01"
                   value="0.30"
                   data-config-key="EMBEDDING_WEIGHT">
          </div>
        </div>

        <footer class="settings-card-footer">
          <p>提示：BM25S 与向量权重总和无需等于 1，系统会自动重新归一化，并在下次检索时生效。</p>
        </footer>
      </section>
    </div>
    <!-- 数据库页面 -->
    <div id="database-page">
      <div class="database-section">
        <h2>数据库管理</h2>
        
        <!-- 数据库类型选择tab -->
        <div class="db-tabs">
          <button class="db-tab-btn active" data-tab="sqlite">SQLite 数据库</button>
          <button class="db-tab-btn" data-tab="faiss">Faiss 向量数据库</button>
          <button class="db-tab-btn" data-tab="image-vectors">图片向量存储</button>
        </div>
        
        <!-- SQLite 数据库面板 -->
        <div id="sqlite-panel" class="db-panel active">
          <div class="database-controls">
            <button id="test-db-connection" class="db-btn">测试连接</button>
            <button id="get-all-tables" class="db-btn">获取所有表</button>
            <div class="table-query-group">
              <select id="table-select">
                <option value="">选择表...</option>
              </select>
              <button id="query-table" class="db-btn">查询表数据</button>
            </div>
          </div>
          
          <div class="database-status">
            <div id="db-status" class="status-indicator"></div>
          </div>
          
          <div class="database-results">
            <div id="db-tables-list" class="tables-section">
              <h3>数据库表列表</h3>
              <div id="tables-content"></div>
            </div>
            
            <div id="db-table-data" class="table-data-section">
              <h3>表数据
                <button id="delete-all-data" class="db-btn delete-btn" style="display: none; margin-left: 10px; background-color: #dc3545;">删除所有数据</button>
                <button id="cleanup-sqlite-data" class="db-btn delete-btn" style="display: inline-block; margin-left: 10px; background-color: #dc3545;">清空SQLite数据</button>
              </h3>
              <div id="table-data-content"></div>
            </div>
          </div>
        </div>
        
        <!-- Faiss 向量数据库面板 -->
        <div id="faiss-panel" class="db-panel">
          <div class="database-controls">
            <button id="test-faiss-connection" class="db-btn">测试连接</button>
            <button id="get-faiss-statistics" class="db-btn">获取统计信息</button>
            <div class="vector-query-group">
              <select id="vector-type-select">
                <option value="">选择向量类型...</option>
              </select>
              <button id="query-vectors" class="db-btn">查询向量数据</button>
            </div>
          </div>
          
          <div class="database-status">
            <div id="faiss-status" class="status-indicator"></div>
          </div>
          
          <div class="database-results">
            <div id="faiss-statistics" class="statistics-section">
              <h3>Faiss 统计信息</h3>
              <div id="statistics-content"></div>
            </div>
            
            <div id="faiss-vectors-data" class="vectors-data-section">
              <h3>向量数据
                <button id="cleanup-faiss-vectors" class="db-btn delete-btn" style="display: inline-block; margin-left: 10px; background-color: #dc3545;">清空Faiss向量</button>
              </h3>
              <div id="vectors-data-content"></div>
            </div>
          </div>
        </div>

        <!-- 图片向量存储面板 -->
        <div id="image-vectors-panel" class="db-panel">
          <div class="database-controls image-vector-controls">
            <div class="image-search-group">
              <input type="text" id="image-vector-search" placeholder="按文件名、路径或图片名搜索" />
              <button id="search-image-vectors" class="db-btn">搜索</button>
              <button id="reset-image-vector-search" class="db-btn secondary-btn">重置</button>
            </div>
            <div class="image-page-size">
              <label for="image-vector-page-size">每页数量:</label>
              <select id="image-vector-page-size">
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100" selected>100</option>
                <option value="200">200</option>
              </select>
            </div>
          </div>

          <div class="database-status">
            <div id="image-vectors-status" class="status-indicator"></div>
          </div>

          <div class="database-results image-vector-results">
            <div id="image-vector-stats" class="statistics-section">
              <h3>图片向量统计</h3>
              <div id="image-vector-stats-content" class="image-stats-content"></div>
            </div>

            <div id="image-vector-data" class="vectors-data-section">
              <h3>图片向量列表</h3>
              <div id="image-vector-table" class="image-vector-table"></div>
              <div class="image-pagination">
                <button id="image-vector-prev" class="db-btn secondary-btn">上一页</button>
                <span id="image-vector-page-info"></span>
                <button id="image-vector-next" class="db-btn secondary-btn">下一页</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- 模块化样式文件 -->
  <link rel="stylesheet" href="./src/styles/splash.css">
  <link rel="stylesheet" href="./src/styles/settings.css">
  <link rel="stylesheet" href="./src/styles/explorer.css">
  <link rel="stylesheet" href="./src/styles/chat.css">
  <link rel="stylesheet" href="./src/styles/database.css">
  
  <script src="./src/modules/splash.js"></script>
  <script src="./src/modules/tab-manager.js"></script>
  <script src="./src/components/textViewer.js"></script>
  <script src="./src/components/wordViewer.js"></script>
  <script src="./src/components/markdownViewer.js"></script>
  <script src="./src/components/htmlViewer.js"></script>
  <script src="./src/components/pdfViewer.js"></script>
  <script src="./src/components/pptViewer.js"></script>
  <script src="./src/components/fileViewer.js"></script>
  <script src="./src/modules/settings.js"></script>
  <script src="./src/modules/explorer.js"></script>
  <script src="./src/modules/database.js"></script>
  <script src="./src/modules/chat.js"></script>
  <script src="./icons.js"></script>
  <script src="./static/libs/jszip.min.js"></script>
  <script src="./node_modules/xml2js/lib/xml2js.js"></script>
  <script src="./static/libs/docx-preview.js"></script>
<script src="./node_modules/marked/lib/marked.umd.js"></script>
<script src="./node_modules/highlight.js/lib/index.js"></script>
<script src="./static/libs/pptx-preview.umd.js"></script>
  <script src="./renderer/modules/loadingOverlay.js"></script>
  <script src="./renderer/modules/uploadStatus.js"></script>
  <script src="./renderer/modules/search.js"></script>
  <script src="./renderer/modules/fileTree.js"></script>
  <script src="./renderer/modules/viewState.js"></script>
  <script src="./renderer/modules/modalNotifications.js"></script>
  <script src="./renderer.js"></script>
</body>
</html>
