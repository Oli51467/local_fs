<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>LoFS</title>
  <link rel="stylesheet" data-asset-href="node_modules/github-markdown-css/github-markdown.css">
  <!-- Fira Code 字体 -->
  <link href="https://cdn.jsdelivr.net/npm/firacode/distr/fira_code.css" rel="stylesheet">
  <style>
    :root {
      --bg-color: #fafafa;
      --text-color: #333333;
      --text-muted: #6c6c6c;
      --sidebar-bg: #d1d5db;
      --sidebar-text: #4a5568;
      --tree-bg: #f8f8f8;
      --tree-border: #e1e4e8;
      --tree-hover: #f0f0f0;
      --accent-color: #0366d6;
      --accent-hover: #0256cc;
      --border-light: #d1d9e0;
      --shadow-light: rgba(27, 31, 35, 0.04);
    }

    .dark-mode {
      --bg-color: #1e1e1e;
      --text-color: #cccccc;
      --text-muted: #969696;
      --sidebar-bg: #181818;
      --sidebar-text: #cccccc;
      --tree-bg: #252526;
      --tree-border: #3c3c3c;
      --tree-hover: #2a2d2e;
      --accent-color: #0e639c;
      --accent-hover: #1177bb;
      --border-light: #3c3c3c;
      --shadow-light: rgba(0, 0, 0, 0.3);
    }

    @font-face {
      font-family: 'SimSun';
      src: local('SimSun');
    }

    html,
    body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: 'Times New Roman', SimSun, serif;
      font-size: 14px;
      background-color: var(--bg-color);
      color: var(--text-color);
    }

    /* 全局移除outline */
    * {
      outline: none !important;
    }

    #app {
      display: flex;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    /* 最左侧 sidebar */
    #sidebar {
      width: 50px;
      background: var(--sidebar-bg);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      color: var(--sidebar-text);
    }

    .sidebar-top,
    .sidebar-bottom {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #sidebar button {
      background: none;
      border: none;
      color: var(--sidebar-text);
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 5px 0;
      cursor: pointer;
      border-radius: 4px;
      transition: background-color 0.2s;
    }

    #sidebar button:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    #sidebar button svg {
      width: 20px;
      height: 20px;
    }

    /* 资源管理器相关样式已移至 src/styles/explorer.css */

    /* 文件内容展示 */
    #file-content {
      flex: 1;
      padding: 0;
      overflow-y: auto;
      overflow-x: hidden;
      scrollbar-width: thin;
      scrollbar-color: rgba(71, 85, 105, 0.85) transparent;
    }

    #file-content::-webkit-scrollbar {
      width: 6px;
    }

    #file-content::-webkit-scrollbar-track {
      background: transparent;
    }

    #file-content::-webkit-scrollbar-thumb {
      background-color: rgba(71, 85, 105, 0.85);
      border-radius: 999px;
    }

    /* 设置页面样式已移至 src/styles/settings.css */
  </style>
</head>

<body>
  <!-- 启动页面 -->
  <div id="splash-screen">
    <div class="splash-container">
      <div class="splash-logo">
        <div class="logo-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M3 7V17C3 18.1046 3.89543 19 5 19H19C20.1046 19 21 18.1046 21 17V7C21 5.89543 20.1046 5 19 5H5C3.89543 5 3 5.89543 3 7Z"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M8 21L16 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
            <path d="M12 17L12 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
        </div>
        <h1 class="splash-title">LoFS</h1>
        <p class="splash-subtitle">Load Once Fast Search</p>
      </div>

      <div class="splash-loading">
        <div class="loading-spinner"></div>
        <p class="loading-text">正在初始化系统...</p>
      </div>

      <div class="splash-footer">
        <p class="version-info">Designed and powered by Oli51467</p>
      </div>
    </div>
  </div>

  <div id="app" style="display: none;">
    <!-- 左侧 sidebar -->
    <div id="sidebar">
      <div class="sidebar-top">
        <button id="toggle-tree">
          <div id="file-icon"></div>
        </button>
        <button id="search-btn">
          <div id="search-icon"></div>
        </button>
        <button id="chat-btn">
          <div id="chat-icon"></div>
        </button>
        <button id="model-btn">
          <div id="model-icon"></div>
        </button>
      </div>
      <div class="sidebar-bottom">
        <button id="settings-btn">
          <div id="settings-icon"></div>
        </button>
        <button id="database-btn">
          <div id="database-icon"></div>
        </button>
      </div>
    </div>

    <!-- 文件树栏 -->
    <div id="file-tree-container">
      <div id="file-tree-resizer"></div>
      <div id="file-tree-header">
        <span id="resource-title">资源管理器</span>
        <div>
          <button id="new-folder">
            <div id="folder-icon"></div>
          </button>
          <button id="new-file">
            <div id="new-file-icon"></div>
          </button>
          <button id="import-files">
            <div id="import-icon"></div>
          </button>
          <button id="refresh-tree">
            <div id="refresh-icon"></div>
          </button>
          <button id="delete-item">
            <div id="trash-icon"></div>
          </button>
        </div>
      </div>
      <div id="file-tree">Loading...</div>

      <!-- 搜索区域 -->
      <div id="search-area" style="display: none;">
        <div id="search-input-container">
          <textarea id="search-input" placeholder="搜索文件内容" rows="1"></textarea>
          <div id="search-mode-toggle">
            <button class="search-mode-btn active" data-mode="text">文本检索</button>
            <button class="search-mode-btn" data-mode="image">图片检索</button>
          </div>
        </div>
        <div id="search-history"></div>
      </div>
    </div>

    <!-- 对话历史栏 -->
    <div id="chat-history-container" style="display: none;">
      <div id="chat-history-header">
        <span id="chat-history-title">对话历史</span>
        <button id="chat-history-collapse-btn" class="chat-history-collapse-btn">
          <!-- 折叠按钮图标将通过JavaScript设置 -->
        </button>
      </div>
      <div id="chat-history-list"></div>
    </div>

    <!-- 文件内容展示 -->
    <div id="file-content"></div>

    <!-- 对话页面 -->
    <div id="chat-page" style="display: none;">
      <div id="chat-page-header">
        <div class="chat-page-header-info">
          <div class="chat-model-selector">
            <button id="chat-model-button" class="chat-model-button" type="button" aria-haspopup="listbox" aria-expanded="false">
              <span id="chat-model-button-text" class="chat-model-button-text">暂无可用模型</span>
              <span class="chat-model-button-icon"></span>
            </button>
            <div id="chat-model-dropdown" class="chat-model-dropdown" role="listbox" aria-label="聊天模型列表"></div>
          </div>
          <!-- 折叠状态下的展开按钮 -->
          <button id="collapsed-expand-btn" class="collapsed-expand-btn" style="display: none;">
            <!-- 展开按钮图标将通过JavaScript设置 -->
          </button>
          <span id="chat-conversation-updated" class="chat-timestamp"></span>
        </div>
        <div class="chat-page-header-actions"></div>
      </div>
      <div id="chat-messages-container">
        <div id="chat-messages"></div>
      </div>
      <div id="chat-input-area">
        <div id="chat-status-text"></div>
        <div class="chat-input-wrapper">
          <textarea id="chat-input" rows="1" placeholder="询问任何问题" autocomplete="off" spellcheck="false"></textarea>
          <button id="chat-send-btn" type="button" aria-label="发送消息">
            <svg class="icon-arrow" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M5 12h14M13 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- 模型页面 -->
    <div id="model-page" style="display: none;">
      <div class="model-page">
        <section class="model-content">
          <div class="model-content-header">
            <div class="model-header-titles">
              <h2 id="model-provider-title">模型库</h2>
            </div>
            <button id="model-add-btn" class="model-add-btn" type="button" aria-label="添加模型">
              <span class="model-add-btn__icon">+</span>
              <span>添加</span>
            </button>
          </div>
          <div id="model-card-container" class="model-card-container"></div>
        </section>
      </div>
    </div>

    <!-- 设置页面 -->
    <div id="settings-page">
      <section class="settings-section">
        <h2>外观</h2>
        <div class="settings-divider"></div>
        <div class="setting-item">
          <span>深色模式</span>
          <label class="toggle-switch">
            <input type="checkbox" id="dark-mode-toggle">
            <span class="slider"></span>
          </label>
        </div>
      </section>

      <section class="settings-section">
        <div class="settings-section-header">
          <h2>检索</h2>
          <div class="retrieval-actions">
            <span id="retrieval-settings-status" class="settings-status-text" aria-live="polite"></span>
            <div class="retrieval-actions-buttons">
              <button type="button" id="retrieval-settings-reload" class="settings-btn ghost">恢复</button>
              <button type="button" id="retrieval-settings-save" class="settings-btn primary" disabled>保存</button>
            </div>
          </div>
        </div>
        <div class="settings-divider"></div>
        <div class="settings-retrieval-panel" id="retrieval-settings-card">
          <div class="retrieval-grid">
            <div class="settings-slider" data-config-key="RECURSIVE_CHUNK_SIZE">
              <div class="slider-header">
                <div class="slider-title">
                  <span class="slider-label">递归分块大小</span>
                </div>
                <span class="slider-value" id="retrieval-chunk-size-value">-</span>
              </div>
              <input type="range" id="retrieval-chunk-size" min="50" max="2000" step="10" value="300"
                data-config-key="RECURSIVE_CHUNK_SIZE">
            </div>

            <div class="settings-slider" data-config-key="RECURSIVE_CHUNK_OVERLAP">
              <div class="slider-header">
                <div class="slider-title">
                  <span class="slider-label">分块重叠</span>
                </div>
                <span class="slider-value" id="retrieval-chunk-overlap-value">-</span>
              </div>
              <input type="range" id="retrieval-chunk-overlap" min="0" max="500" step="5" value="80"
                data-config-key="RECURSIVE_CHUNK_OVERLAP">
            </div>

            <div class="settings-slider" data-config-key="BM25S_WEIGHT">
              <div class="slider-header">
                <div class="slider-title">
                  <span class="slider-label">BM25S 权重</span>
                </div>
                <span class="slider-value" id="retrieval-bm25s-weight-value">-</span>
              </div>
              <input type="range" id="retrieval-bm25s-weight" min="0" max="1" step="0.01" value="0.70"
                data-config-key="BM25S_WEIGHT">
            </div>

            <div class="settings-slider" data-config-key="EMBEDDING_WEIGHT">
              <div class="slider-header">
                <div class="slider-title">
                  <span class="slider-label">向量检索权重</span>
                </div>
                <span class="slider-value" id="retrieval-embedding-weight-value">-</span>
              </div>
              <input type="range" id="retrieval-embedding-weight" min="0" max="1" step="0.01" value="0.30"
                data-config-key="EMBEDDING_WEIGHT">
            </div>
          </div>
        </div>
      </section>

      <section class="settings-section">
        <div class="settings-section-header">
          <h2>API-Key</h2>
          <div class="retrieval-actions">
            <span id="api-settings-status" class="settings-status-text" aria-live="polite"></span>
            <div class="retrieval-actions-buttons">
              <button type="button" id="api-settings-save" class="settings-btn primary" disabled>更新</button>
            </div>
          </div>
        </div>
        <div class="settings-divider"></div>
        <div class="settings-form-grid">
          <div class="settings-input-field">
            <label for="api-key-openai" class="settings-input-label">OpenAI API Key</label>
            <div class="settings-input-control">
              <input type="password" id="api-key-openai" class="settings-input" placeholder="sk-..." autocomplete="off"
                autocapitalize="none" spellcheck="false" data-settings-key="openaiApiKey">
              <button type="button" class="settings-input-visibility-toggle" data-target-input="api-key-openai"
                data-platform-name="OpenAI" aria-label="显示 OpenAI API Key" aria-pressed="false">
                <svg class="icon-eye icon-eye-open" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"
                  focusable="false">
                  <path d="M12 5C6.9 5 3.1 8.3 1.5 12c1.6 3.7 5.4 7 10.5 7s8.9-3.3 10.5-7C20.9 8.3 17.1 5 12 5Z"
                    stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"
                    stroke-linejoin="round" />
                  <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="1.6" />
                </svg>
                <svg class="icon-eye icon-eye-closed" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"
                  focusable="false">
                  <path d="M3 3l18 18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                  <path
                    d="M9.5 5.6C10.3 5.3 11.1 5 12 5c5.1 0 8.9 3.3 10.5 7-.6 1.2-1.4 2.3-2.4 3.2m-6.7 2.1c-.5.1-1 .1-1.4.1-5.1 0-8.9-3.3-10.5-7 1-2.3 3-4.3 5.5-5.5"
                    stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"
                    fill="none" />
                  <path d="M14.5 14.5a3 3 0 0 1-4.2-4.2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                    stroke-linejoin="round" fill="none" />
                </svg>
              </button>
            </div>
            <p class="settings-input-hint">用于访问 OpenAI 模型服务。</p>
          </div>

          <div class="settings-input-field">
            <label for="api-key-modelscope" class="settings-input-label">ModelScope API Key</label>
            <div class="settings-input-control">
              <input type="password" id="api-key-modelscope" class="settings-input" placeholder="输入 ModelScope Key"
                autocomplete="off" autocapitalize="none" spellcheck="false" data-settings-key="modelscopeApiKey">
              <button type="button" class="settings-input-visibility-toggle" data-target-input="api-key-modelscope"
                data-platform-name="ModelScope" aria-label="显示 ModelScope API Key" aria-pressed="false">
                <svg class="icon-eye icon-eye-open" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"
                  focusable="false">
                  <path d="M12 5C6.9 5 3.1 8.3 1.5 12c1.6 3.7 5.4 7 10.5 7s8.9-3.3 10.5-7C20.9 8.3 17.1 5 12 5Z"
                    stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"
                    stroke-linejoin="round" />
                  <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="1.6" />
                </svg>
                <svg class="icon-eye icon-eye-closed" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"
                  focusable="false">
                  <path d="M3 3l18 18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                  <path
                    d="M9.5 5.6C10.3 5.3 11.1 5 12 5c5.1 0 8.9 3.3 10.5 7-.6 1.2-1.4 2.3-2.4 3.2m-6.7 2.1c-.5.1-1 .1-1.4.1-5.1 0-8.9-3.3-10.5-7 1-2.3 3-4.3 5.5-5.5"
                    stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"
                    fill="none" />
                  <path d="M14.5 14.5a3 3 0 0 1-4.2-4.2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                    stroke-linejoin="round" fill="none" />
                </svg>
              </button>
            </div>
            <p class="settings-input-hint">用于调用魔搭 ModelScope 平台。</p>
          </div>

          <div class="settings-input-field">
            <label for="api-key-qwen" class="settings-input-label">Qwen API Key</label>
            <div class="settings-input-control">
              <input type="password" id="api-key-qwen" class="settings-input" placeholder="输入 Qwen Key"
                autocomplete="off" autocapitalize="none" spellcheck="false" data-settings-key="qwenApiKey">
              <button type="button" class="settings-input-visibility-toggle" data-target-input="api-key-qwen"
                data-platform-name="Qwen" aria-label="显示 Qwen API Key" aria-pressed="false">
                <svg class="icon-eye icon-eye-open" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"
                  focusable="false">
                  <path d="M12 5C6.9 5 3.1 8.3 1.5 12c1.6 3.7 5.4 7 10.5 7s8.9-3.3 10.5-7C20.9 8.3 17.1 5 12 5Z"
                    stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"
                    stroke-linejoin="round" />
                  <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="1.6" />
                </svg>
                <svg class="icon-eye icon-eye-closed" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"
                  focusable="false">
                  <path d="M3 3l18 18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                  <path
                    d="M9.5 5.6C10.3 5.3 11.1 5 12 5c5.1 0 8.9 3.3 10.5 7-.6 1.2-1.4 2.3-2.4 3.2m-6.7 2.1c-.5.1-1 .1-1.4.1-5.1 0-8.9-3.3-10.5-7 1-2.3 3-4.3 5.5-5.5"
                    stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"
                    fill="none" />
                  <path d="M14.5 14.5a3 3 0 0 1-4.2-4.2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                    stroke-linejoin="round" fill="none" />
                </svg>
              </button>
            </div>
            <p class="settings-input-hint">用于通义千问开放平台。</p>
          </div>

          <div class="settings-input-field">
            <label for="api-key-kimi" class="settings-input-label">Kimi API Key</label>
            <div class="settings-input-control">
              <input type="password" id="api-key-kimi" class="settings-input" placeholder="输入 Kimi Key"
                autocomplete="off" autocapitalize="none" spellcheck="false" data-settings-key="kimiApiKey">
              <button type="button" class="settings-input-visibility-toggle" data-target-input="api-key-kimi"
                data-platform-name="Kimi" aria-label="显示 Kimi API Key" aria-pressed="false">
                <svg class="icon-eye icon-eye-open" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"
                  focusable="false">
                  <path d="M12 5C6.9 5 3.1 8.3 1.5 12c1.6 3.7 5.4 7 10.5 7s8.9-3.3 10.5-7C20.9 8.3 17.1 5 12 5Z"
                    stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"
                    stroke-linejoin="round" />
                  <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="1.6" />
                </svg>
                <svg class="icon-eye icon-eye-closed" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"
                  focusable="false">
                  <path d="M3 3l18 18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                  <path
                    d="M9.5 5.6C10.3 5.3 11.1 5 12 5c5.1 0 8.9 3.3 10.5 7-.6 1.2-1.4 2.3-2.4 3.2m-6.7 2.1c-.5.1-1 .1-1.4.1-5.1 0-8.9-3.3-10.5-7 1-2.3 3-4.3 5.5-5.5"
                    stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"
                    fill="none" />
                  <path d="M14.5 14.5a3 3 0 0 1-4.2-4.2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                    stroke-linejoin="round" fill="none" />
                </svg>
              </button>
            </div>
            <p class="settings-input-hint">用于调用 Moonshot Kimi 服务。</p>
          </div>

          <div class="settings-input-field">
            <label for="api-key-claude" class="settings-input-label">Claude API Key</label>
            <div class="settings-input-control">
              <input type="password" id="api-key-claude" class="settings-input" placeholder="输入 Claude Key"
                autocomplete="off" autocapitalize="none" spellcheck="false" data-settings-key="claudeApiKey">
              <button type="button" class="settings-input-visibility-toggle" data-target-input="api-key-claude"
                data-platform-name="Claude" aria-label="显示 Claude API Key" aria-pressed="false">
                <svg class="icon-eye icon-eye-open" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"
                  focusable="false">
                  <path d="M12 5C6.9 5 3.1 8.3 1.5 12c1.6 3.7 5.4 7 10.5 7s8.9-3.3 10.5-7C20.9 8.3 17.1 5 12 5Z"
                    stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"
                    stroke-linejoin="round" />
                  <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="1.6" />
                </svg>
                <svg class="icon-eye icon-eye-closed" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"
                  focusable="false">
                  <path d="M3 3l18 18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                  <path
                    d="M9.5 5.6C10.3 5.3 11.1 5 12 5c5.1 0 8.9 3.3 10.5 7-.6 1.2-1.4 2.3-2.4 3.2m-6.7 2.1c-.5.1-1 .1-1.4.1-5.1 0-8.9-3.3-10.5-7 1-2.3 3-4.3 5.5-5.5"
                    stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"
                    fill="none" />
                  <path d="M14.5 14.5a3 3 0 0 1-4.2-4.2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                    stroke-linejoin="round" fill="none" />
                </svg>
              </button>
            </div>
            <p class="settings-input-hint">用于访问 Anthropic Claude 模型。</p>
          </div>

          <div class="settings-input-field">
            <label for="api-key-siliconflw" class="settings-input-label">SiliconFlow API Key</label>
            <div class="settings-input-control">
              <input type="password" id="api-key-siliconflw" class="settings-input" placeholder="输入 SiliconFlow Key"
                autocomplete="off" autocapitalize="none" spellcheck="false" data-settings-key="siliconflwApiKey">
              <button type="button" class="settings-input-visibility-toggle" data-target-input="api-key-siliconflw"
                data-platform-name="SiliconFlow" aria-label="显示 SiliconFlow API Key" aria-pressed="false">
                <svg class="icon-eye icon-eye-open" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"
                  focusable="false">
                  <path d="M12 5C6.9 5 3.1 8.3 1.5 12c1.6 3.7 5.4 7 10.5 7s8.9-3.3 10.5-7C20.9 8.3 17.1 5 12 5Z"
                    stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"
                    stroke-linejoin="round" />
                  <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="1.6" />
                </svg>
                <svg class="icon-eye icon-eye-closed" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"
                  focusable="false">
                  <path d="M3 3l18 18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                  <path
                    d="M9.5 5.6C10.3 5.3 11.1 5 12 5c5.1 0 8.9 3.3 10.5 7-.6 1.2-1.4 2.3-2.4 3.2m-6.7 2.1c-.5.1-1 .1-1.4.1-5.1 0-8.9-3.3-10.5-7 1-2.3 3-4.3 5.5-5.5"
                    stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"
                    fill="none" />
                  <path d="M14.5 14.5a3 3 0 0 1-4.2-4.2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                    stroke-linejoin="round" fill="none" />
                </svg>
              </button>
            </div>
            <p class="settings-input-hint">用于调用 SiliconFlow 平台模型。</p>
          </div>
        </div>
      </section>
      </section>
    </div>
    <!-- 数据库页面 -->
    <div id="database-page">
      <div class="database-section">
        <div class="database-header">
          <h2 class="database-title">数据库管理</h2>
          <div class="db-tabs">
            <button class="db-tab-btn active" data-tab="sqlite">文档数据存储</button>
            <button class="db-tab-btn" data-tab="faiss">向量数据存储</button>
            <button class="db-tab-btn" data-tab="image-vectors">图像数据存储</button>
          </div>
        </div>

        <!-- SQLite 数据库面板 -->
        <div id="sqlite-panel" class="db-panel active">
          <div class="database-controls"></div>

          <!-- SQLite 状态栏已移除，自动连接与加载表 -->

          <div class="database-results">
            <div id="db-tables-list" class="tables-section">
              <h3>数据库表列表</h3>
              <div id="tables-content"></div>
            </div>

            <div id="db-table-data" class="table-data-section">
              <h3>表数据</h3>
              <div id="table-data-content"></div>
            </div>
          </div>
        </div>

        <!-- Faiss 向量数据库面板 -->
        <div id="faiss-panel" class="db-panel">
          <div class="database-results">
            <div id="faiss-types-list" class="tables-section">
              <h3>向量类型</h3>
              <div id="faiss-types-content"></div>
            </div>

            <div id="faiss-vectors-data" class="vectors-data-section">
              <h3>向量数据</h3>
              <div id="vectors-data-content"></div>
            </div>
          </div>
        </div>

        <!-- 图片向量存储面板 -->
        <div id="image-vectors-panel" class="db-panel">
          <div class="database-controls image-vector-controls"></div>

          <div class="database-results image-vector-results">

            <div id="image-files-list" class="tables-section">
              <h3>图片文件</h3>
              <div id="image-files-content"></div>
            </div>

            <div id="image-images-data" class="vectors-data-section">
              <div id="image-images-content" class="image-vector-table"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- 模块化样式文件 -->
  <link rel="stylesheet" href="./src/styles/splash.css">
  <link rel="stylesheet" href="./src/styles/settings.css">
  <link rel="stylesheet" href="./src/styles/explorer.css">
  <link rel="stylesheet" href="./src/styles/chat.css">
  <link rel="stylesheet" href="./src/styles/database.css">
  <link rel="stylesheet" href="./src/styles/model.css">
  <link rel="stylesheet" href="./src/styles/codeViewer.css">

  <script src="./src/modules/splash.js"></script>
  <script src="./src/modules/tab-manager.js"></script>
  <script src="./src/components/textViewer.js"></script>
  <script src="./src/components/wordViewer.js"></script>
  <script src="./src/components/markdownViewer.js"></script>
  <script src="./src/components/htmlViewer.js"></script>
  <script src="./src/components/pdfViewer.js"></script>
  <script src="./src/components/pptViewer.js"></script>
  <script src="./src/components/excelViewer.js"></script>
  <script src="./src/components/codeViewer.js"></script>
  <script src="./src/components/fileViewer.js"></script>
  <script src="./src/modules/settings.js"></script>
  <script src="./src/modules/explorer.js"></script>
  <script src="./src/modules/model.js"></script>
  <script src="./src/modules/database.js"></script>
  <script src="./src/modules/chat.js"></script>
  <script src="./icons.js"></script>
  <script src="./static/libs/jszip.min.js"></script>
  <script src="./static/libs/docx-preview.js"></script>
  <script data-asset-src="node_modules/markdown-it/dist/markdown-it.min.js"></script>
  <script>
    (async () => {
      const resolveAsset = window.fsAPI && typeof window.fsAPI.getAssetPathSync === 'function'
        ? (relative) => {
            try {
              return window.fsAPI.getAssetPathSync(relative) || '';
            } catch (error) {
              console.warn('解析资源路径失败:', relative, error);
              return '';
            }
          }
        : null;

      const toFsPath = (maybeFileUrl) => {
        if (!maybeFileUrl) {
          return '';
        }
        if (maybeFileUrl.startsWith('file://')) {
          try {
            return decodeURIComponent(new URL(maybeFileUrl).pathname);
          } catch (error) {
            console.warn('解析 file:// URL 失败:', maybeFileUrl, error);
            return '';
          }
        }
        return maybeFileUrl;
      };

      const fileExists = async (fsPath) => {
        if (!fsPath || !window.fsAPI || typeof window.fsAPI.fileExists !== 'function') {
          return false;
        }
        try {
          return await window.fsAPI.fileExists(fsPath);
        } catch (error) {
          console.warn('检查资源存在性失败:', fsPath, error);
          return false;
        }
      };

      if (!resolveAsset) {
        console.warn('未能获取资源解析器，跳过可选的 node_modules 资源加载。');
        return;
      }

      const styleLinks = Array.from(document.querySelectorAll('link[data-asset-href]'));
      for (const link of styleLinks) {
        const target = link.getAttribute('data-asset-href');
        const resolved = target ? resolveAsset(target) : '';
        const fsPath = toFsPath(resolved);
        const exists = await fileExists(fsPath);
        if (resolved && exists) {
          link.href = resolved;
        } else {
          console.warn('无法解析样式资源或文件不存在:', target);
          link.remove();
        }
      }

      const placeholders = Array.from(document.querySelectorAll('script[data-asset-src]'));
      for (const placeholder of placeholders) {
        const target = placeholder.getAttribute('data-asset-src');
        const resolved = target ? resolveAsset(target) : '';
        const fsPath = toFsPath(resolved);
        const exists = await fileExists(fsPath);

        if (!resolved || !exists) {
          console.warn('脚本资源文件不存在或解析失败:', target);
          placeholder.remove();
          continue;
        }

        await new Promise((resolve) => {
          const script = document.createElement('script');
          Array.from(placeholder.attributes).forEach((attr) => {
            if (attr.name === 'data-asset-src') {
              return;
            }
            script.setAttribute(attr.name, attr.value);
          });
          script.src = resolved;
          script.onload = () => resolve(true);
          script.onerror = () => {
            console.warn('脚本资源加载失败:', resolved);
            resolve(false);
          };
          placeholder.parentNode.insertBefore(script, placeholder);
          placeholder.remove();
        });
      }
    })();
  </script>
  <script src="./static/libs/pptx-preview.umd.js"></script>
  <script src="./renderer/modules/loadingOverlay.js"></script>
  <script src="./renderer/modules/uploadStatus.js"></script>
  <script src="./renderer/modules/search.js"></script>
  <script src="./renderer/modules/fileTree.js"></script>
  <script src="./renderer/modules/viewState.js"></script>
  <script src="./renderer/modules/modalNotifications.js"></script>
  <script src="./renderer.js"></script>
</body>

</html>
