<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Markdown 渲染测试</title>
  <link rel="stylesheet" href="./node_modules/github-markdown-css/github-markdown.css">
  <script src="./node_modules/marked/marked.min.js"></script>
  <script src="./node_modules/highlight.js/lib/common.js"></script>
  <link rel="stylesheet" href="./node_modules/highlight.js/styles/github.min.css">
  <style>
    body {
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    .test-section {
      margin: 20px 0;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 5px;
    }
    .test-title {
      background: #f6f8fa;
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      border-bottom: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <h1>Markdown 渲染测试页面</h1>
  
  <div class="test-section">
    <div class="test-title">库加载状态</div>
    <div id="library-status"></div>
  </div>
  
  <div class="test-section">
    <div class="test-title">原始 Markdown 内容</div>
    <pre id="raw-markdown"></pre>
  </div>
  
  <div class="test-section">
    <div class="test-title">渲染后的 HTML</div>
    <div id="rendered-html" class="markdown-body"></div>
  </div>

  <script>
    // 测试 Markdown 内容
    const testMarkdown = `# Markdown 渲染测试

## 1. 横线测试
这是第一段文字。

---

这是横线后的文字。

## 2. 表格测试

| 列1 | 列2 | 列3 |
|-----|-----|-----|
| 数据1 | 数据2 | 数据3 |
| 测试A | 测试B | 测试C |

## 3. 代码片段测试

行内代码：\`console.log('Hello World')\`

代码块：
\`\`\`javascript
function test() {
    console.log('这是一个测试函数');
    return true;
}
\`\`\`

## 4. 列表测试

### 有序列表
1. 第一项
2. 第二项
3. 第三项

### 无序列表
- 项目A
- 项目B
- 项目C

## 5. 引用测试

> 这是一个引用块
> 可以包含多行内容

## 6. 强调测试

**粗体文字** 和 *斜体文字* 以及 ~~删除线~~`;

    // 检查库加载状态
    function checkLibraries() {
      const status = document.getElementById('library-status');
      let html = '';
      
      html += `<p>marked 库: ${typeof marked !== 'undefined' ? '✅ 已加载' : '❌ 未加载'}</p>`;
      html += `<p>hljs 库: ${typeof hljs !== 'undefined' ? '✅ 已加载' : '❌ 未加载'}</p>`;
      
      if (typeof marked !== 'undefined') {
        html += `<p>marked 版本: ${marked.version || '未知'}</p>`;
      }
      
      if (typeof hljs !== 'undefined') {
        html += `<p>hljs 版本: ${hljs.versionString || '未知'}</p>`;
      }
      
      status.innerHTML = html;
    }

    // 渲染 Markdown
    function renderMarkdown() {
      const rawElement = document.getElementById('raw-markdown');
      const renderedElement = document.getElementById('rendered-html');
      
      // 显示原始内容
      rawElement.textContent = testMarkdown;
      
      if (typeof marked !== 'undefined') {
        try {
          // 配置 marked
          marked.setOptions({
            gfm: true,
            breaks: true,
            headerIds: true,
            mangle: false,
            highlight: function (code, lang) {
              if (typeof hljs !== 'undefined') {
                try {
                  if (lang && hljs.getLanguage(lang)) {
                    return hljs.highlight(code, { language: lang }).value;
                  }
                  return hljs.highlightAuto(code).value;
                } catch (e) {
                  console.warn('Highlight.js error:', e);
                  return code;
                }
              }
              return code;
            }
          });
          
          // 解析 Markdown
          const html = marked.parse(testMarkdown);
          console.log('Generated HTML:', html);
          
          // 显示渲染结果
          renderedElement.innerHTML = html;
          
        } catch (error) {
          console.error('Markdown parsing error:', error);
          renderedElement.innerHTML = `<p style="color: red;">渲染错误: ${error.message}</p>`;
        }
      } else {
        renderedElement.innerHTML = '<p style="color: red;">marked 库未加载</p>';
      }
    }

    // 页面加载完成后执行测试
    window.addEventListener('load', function() {
      checkLibraries();
      renderMarkdown();
    });
  </script>
</body>
</html>